<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Android基础——Notification | yuweiguo&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="本文介绍了通知的使用，包括大文本、大图片等扩展样式通知及在通知上显示进度指示器和浮动通知的触发条件。">
<meta property="og:type" content="article">
<meta property="og:title" content="Android基础——Notification">
<meta property="og:url" content="http://yoursite.com/2016/09/16/android-basic-notification/index.html">
<meta property="og:site_name" content="yuweiguo's blog">
<meta property="og:description" content="本文介绍了通知的使用，包括大文本、大图片等扩展样式通知及在通知上显示进度指示器和浮动通知的触发条件。">
<meta property="og:image" content="http://yoursite.com/assets/img/basic/notification/notification-simple-1.png">
<meta property="og:image" content="http://yoursite.com/assets/img/basic/notification/notification-simple-2.png">
<meta property="og:image" content="http://yoursite.com/assets/img/basic/notification/notification-pending-intent-normal.gif">
<meta property="og:image" content="http://yoursite.com/assets/img/basic/notification/notification-pending-intent-special.gif">
<meta property="og:image" content="http://yoursite.com/assets/img/basic/notification/notification-big-text.gif">
<meta property="og:image" content="http://yoursite.com/assets/img/basic/notification/notification-inbox.png">
<meta property="og:image" content="http://yoursite.com/assets/img/basic/notification/notification-big-picture.png">
<meta property="og:image" content="http://yoursite.com/assets/img/basic/notification/notification-media-style.png">
<meta property="og:image" content="http://yoursite.com/assets/img/basic/notification/notification-update.png">
<meta property="og:image" content="http://yoursite.com/assets/img/basic/notification/notification-progress.png">
<meta property="og:image" content="http://yoursite.com/assets/img/basic/notification/notification-progress-indederminate.png">
<meta property="og:image" content="http://yoursite.com/assets/img/basic/notification/notification-floating-full-screen.gif">
<meta property="og:image" content="http://yoursite.com/assets/img/basic/notification/notification-floating-priority.png">
<meta property="og:image" content="http://yoursite.com/assets/img/basic/notification/notification-inline-reply.png">
<meta property="og:image" content="http://yoursite.com/assets/img/basic/notification/notification-inline-type-reply.png">
<meta property="og:image" content="http://yoursite.com/assets/img/basic/notification/notification-bundles.png">
<meta property="og:updated_time" content="2016-09-20T02:29:44.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android基础——Notification">
<meta name="twitter:description" content="本文介绍了通知的使用，包括大文本、大图片等扩展样式通知及在通知上显示进度指示器和浮动通知的触发条件。">
  
    <link rel="alternative" href="/atom.xml" title="yuweiguo&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="assets/img/yuweiguo.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">于卫国</a></h1>
		</hgroup>

		
		<p class="header-subtitle">和喜欢的一切在一起。</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/yuweiguocn" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/weiguo58" title="weibo">weibo</a>
					        
								<a class="mail" target="_blank" href="mailto:yuweiguocn@gmail.com" title="mail">mail</a>
					        
								<a class="dashang" target="_blank" href="http://yuweiguocn.github.io/2015/06/19/dashang/" title="dashang">dashang</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/aidl/" style="font-size: 10px;">aidl</a> <a href="/tags/android/" style="font-size: 20px;">android</a> <a href="/tags/android-studio/" style="font-size: 14.44px;">android studio</a> <a href="/tags/android-ux/" style="font-size: 10px;">android ux</a> <a href="/tags/asynctask/" style="font-size: 10px;">asynctask</a> <a href="/tags/basic/" style="font-size: 17.78px;">basic</a> <a href="/tags/blog/" style="font-size: 10px;">blog</a> <a href="/tags/broadcast/" style="font-size: 10px;">broadcast</a> <a href="/tags/bug/" style="font-size: 10px;">bug</a> <a href="/tags/data-binding/" style="font-size: 13.33px;">data binding</a> <a href="/tags/demo/" style="font-size: 14.44px;">demo</a> <a href="/tags/design/" style="font-size: 10px;">design</a> <a href="/tags/doc/" style="font-size: 16.67px;">doc</a> <a href="/tags/error/" style="font-size: 10px;">error</a> <a href="/tags/guide/" style="font-size: 12.22px;">guide</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/intentservice/" style="font-size: 10px;">intentservice</a> <a href="/tags/interview/" style="font-size: 14.44px;">interview</a> <a href="/tags/java/" style="font-size: 12.22px;">java</a> <a href="/tags/lint/" style="font-size: 10px;">lint</a> <a href="/tags/mac/" style="font-size: 11.11px;">mac</a> <a href="/tags/note/" style="font-size: 10px;">note</a> <a href="/tags/notification/" style="font-size: 10px;">notification</a> <a href="/tags/other/" style="font-size: 10px;">other</a> <a href="/tags/peformance/" style="font-size: 10px;">peformance</a> <a href="/tags/perfermance/" style="font-size: 10px;">perfermance</a> <a href="/tags/program/" style="font-size: 10px;">program</a> <a href="/tags/series/" style="font-size: 14.44px;">series</a> <a href="/tags/service/" style="font-size: 12.22px;">service</a> <a href="/tags/software/" style="font-size: 10px;">software</a> <a href="/tags/solution/" style="font-size: 10px;">solution</a> <a href="/tags/source/" style="font-size: 10px;">source</a> <a href="/tags/summary/" style="font-size: 10px;">summary</a> <a href="/tags/support/" style="font-size: 18.89px;">support</a> <a href="/tags/teach/" style="font-size: 10px;">teach</a> <a href="/tags/tips/" style="font-size: 15.56px;">tips</a> <a href="/tags/toolbar/" style="font-size: 10px;">toolbar</a> <a href="/tags/translate/" style="font-size: 17.78px;">translate</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://litten.github.io/">Litten</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com">Github</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.csdn.net/growth58">CSDN</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">于卫国</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="assets/img/yuweiguo.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">于卫国</h1>
			</hgroup>
			
			<p class="header-subtitle">和喜欢的一切在一起。</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/yuweiguocn" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/weiguo58" title="weibo">weibo</a>
			        
						<a class="mail" target="_blank" href="mailto:yuweiguocn@gmail.com" title="mail">mail</a>
			        
						<a class="dashang" target="_blank" href="http://yuweiguocn.github.io/2015/06/19/dashang/" title="dashang">dashang</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-android-basic-notification" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/09/16/android-basic-notification/" class="article-date">
  	<time datetime="2016-09-16T01:01:55.000Z" itemprop="datePublished">2016-09-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Android基础——Notification
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/basic/">basic</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/notification/">notification</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文介绍了通知的使用，包括大文本、大图片等扩展样式通知及在通知上显示进度指示器和浮动通知的触发条件。</p>
<a id="more"></a>
<h3 id="简单的通知"><a href="#简单的通知" class="headerlink" title="简单的通知"></a>简单的通知</h3><p>一个通知必须要设置的属性：</p>
<ul>
<li>小图标，由setSmallIcon设置</li>
<li>标题，由setContentTitle设置</li>
<li>内容，由setContentText设置</li>
</ul>
<p>从Android 5.0之后，通知可以显示在锁定屏幕上。</p>
<p>这里我们先抽出两个公用方法，generateBuilder()方法用于生成Builder对象，notify()方法用于设置PendingIntent并发出通知：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> NotificationCompat.<span class="function">Builder <span class="title">generateBuilder</span><span class="params">(String title, String content)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> NotificationCompat.Builder(ct)</span><br><span class="line">            .setSmallIcon(R.mipmap.ic_launcher)</span><br><span class="line">            .setContentTitle(title)</span><br><span class="line">            .setContentText(content)</span><br><span class="line">            .setTicker(content)</span><br><span class="line">            .setAutoCancel(<span class="literal">true</span>)</span><br><span class="line">            .setDefaults(NotificationCompat.DEFAULT_ALL);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">notify</span><span class="params">(<span class="keyword">int</span> notifyID, NotificationCompat.Builder mBuilder)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Creates an explicit intent for an Activity in your app</span></span><br><span class="line">    Intent resultIntent = <span class="keyword">new</span> Intent(ct, AboutActivity.<span class="keyword">class</span>);</span><br><span class="line">    <span class="comment">// The stack builder object will contain an artificial back stack for the</span></span><br><span class="line">    <span class="comment">// started Activity.</span></span><br><span class="line">    <span class="comment">// This ensures that navigating backward from the Activity leads out of</span></span><br><span class="line">    <span class="comment">// your application to the Home screen.</span></span><br><span class="line">    TaskStackBuilder stackBuilder = TaskStackBuilder.create(ct);</span><br><span class="line">    <span class="comment">// Adds the back stack for the Intent (but not the Intent itself)</span></span><br><span class="line">    stackBuilder.addParentStack(AboutActivity.<span class="keyword">class</span>);</span><br><span class="line">    <span class="comment">// Adds the Intent that starts the Activity to the top of the stack</span></span><br><span class="line">    stackBuilder.addNextIntent(resultIntent);</span><br><span class="line">    PendingIntent resultPendingIntent =</span><br><span class="line">            stackBuilder.getPendingIntent(<span class="number">0</span>, PendingIntent.FLAG_UPDATE_CURRENT);</span><br><span class="line">    mBuilder.setContentIntent(resultPendingIntent);</span><br><span class="line">    NotificationManager mNotificationManager =</span><br><span class="line">            (NotificationManager) ct.getSystemService(Context.NOTIFICATION_SERVICE);</span><br><span class="line">    <span class="comment">// mId allows you to update the notification later on.</span></span><br><span class="line">    mNotificationManager.notify(notifyID, mBuilder.build());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后通过调用上面两个方法创建一个简单的通知：<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="literal">void</span> simpleNotification(View view) &#123;</span><br><span class="line">    <span class="built_in">String</span> title = <span class="string">"Simple Notification"</span>;</span><br><span class="line">    <span class="built_in">String</span> content = <span class="string">"Hello World!"</span>;</span><br><span class="line">    NotificationCompat<span class="built_in">.</span>Builder mBuilder = generateBuilder(title, content);</span><br><span class="line">    notify(UUID<span class="built_in">.</span>randomUUID()<span class="built_in">.</span>hashCode(), mBuilder);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/assets/img/basic/notification/notification-simple-1.png" alt=""><br>Android 5.1 &amp; Android 4.3</p>
<p>从Android 5.0后，通知会显示在锁定屏幕上，锁屏效果图：<br><img src="/assets/img/basic/notification/notification-simple-2.png" alt=""><br>Android 5.1 &amp; Android 4.3</p>
<h3 id="常规的Activity-PendingIntent"><a href="#常规的Activity-PendingIntent" class="headerlink" title="常规的Activity PendingIntent"></a>常规的Activity PendingIntent</h3><p>从上面的例子，当用户点击通知进入详情页面，从详情页面返回时进入应用主页面，首先我们需要修改清单文件，<code>&lt;meta-data .../&gt;</code>元素是为支持Android 4.0.3及更低的版本，属性android:parentActivityName是为了支持Android 4.1及更高的版本：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">activity</span> <span class="attribute">android:name</span>=<span class="value">".ui.main.MainActivity"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.action.MAIN"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">category</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.category.LAUNCHER"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">activity</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">activity</span></span><br><span class="line">    <span class="attribute">android:name</span>=<span class="value">".ui.about.AboutActivity"</span></span><br><span class="line">    <span class="attribute">android:label</span>=<span class="value">"@string/about"</span></span><br><span class="line">    <span class="attribute">android:parentActivityName</span>=<span class="value">".ui.main.MainActivity"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta-data</span></span><br><span class="line">        <span class="attribute">android:name</span>=<span class="value">"android.support.PARENT_ACTIVITY"</span></span><br><span class="line">        <span class="attribute">android:value</span>=<span class="value">".ui.main.MainActivity"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">activity</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>通过TaskStackBuilder类设置任务栈：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Creates an explicit intent for an Activity in your app</span></span><br><span class="line">Intent resultIntent = <span class="keyword">new</span> Intent(ct, AboutActivity.<span class="keyword">class</span>);</span><br><span class="line"><span class="comment">// The stack builder object will contain an artificial back stack for the</span></span><br><span class="line"><span class="comment">// started Activity.</span></span><br><span class="line"><span class="comment">// This ensures that navigating backward from the Activity leads out of</span></span><br><span class="line"><span class="comment">// your application to the Home screen.</span></span><br><span class="line">TaskStackBuilder stackBuilder = TaskStackBuilder.create(ct);</span><br><span class="line"><span class="comment">// Adds the back stack for the Intent (but not the Intent itself)</span></span><br><span class="line">stackBuilder.addParentStack(AboutActivity.<span class="keyword">class</span>);</span><br><span class="line"><span class="comment">// Adds the Intent that starts the Activity to the top of the stack</span></span><br><span class="line">stackBuilder.addNextIntent(resultIntent);</span><br><span class="line">PendingIntent resultPendingIntent =</span><br><span class="line">        stackBuilder.getPendingIntent(<span class="number">0</span>, PendingIntent.FLAG_UPDATE_CURRENT);</span><br><span class="line">mBuilder.setContentIntent(resultPendingIntent);</span><br></pre></td></tr></table></figure></p>
<p><img src="/assets/img/basic/notification/notification-pending-intent-normal.gif" alt=""></p>
<blockquote>
<p>如果按照上面代码配置后没有作用时请将应用缷载再重新安装即可，这可能是由于Android Studio的即时运行导致的。</p>
</blockquote>
<h3 id="特殊的Activity-PendingIntent"><a href="#特殊的Activity-PendingIntent" class="headerlink" title="特殊的Activity PendingIntent"></a>特殊的Activity PendingIntent</h3><p>当一个Activity只能从通知进入时，配置清单文件，excludeFromRecents属性是为了从最近任务列表中移除，taskAffinity属性和在代码中设置FLAG_ACTIVITY_NEW_TASK标志是为了确保Activity不会进入应用的默认任务栈：<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity android:<span class="property">name</span>=<span class="string">".ui.special.SpecialActivity"</span></span><br><span class="line">          android:launchMode=<span class="string">"singleTask"</span></span><br><span class="line">          android:taskAffinity=<span class="string">".special"</span></span><br><span class="line">          android:label=<span class="string">"@string/special"</span></span><br><span class="line">          android:excludeFromRecents=<span class="string">"true"</span>/&gt;</span><br></pre></td></tr></table></figure></p>
<p>通过设置FLAG_ACTIVITY_NEW_TASK 和 FLAG_ACTIVITY_CLEAR_TASK将Intent设置为在新的空任务栈中启动：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">specialActivityNotification</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        String title = <span class="string">"Special Activity Notification"</span>;</span><br><span class="line">        String content = <span class="string">"Android 7.0 Nougat is here!"</span>;</span><br><span class="line"></span><br><span class="line">    NotificationCompat.Builder mBuilder = generateBuilder(title, content);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Creates an Intent for the Activity</span></span><br><span class="line">    Intent notifyIntent =</span><br><span class="line">            <span class="keyword">new</span> Intent(ct, SpecialActivity.<span class="keyword">class</span>);</span><br><span class="line">    <span class="comment">// Sets the Activity to start in a new, empty task</span></span><br><span class="line">    notifyIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK</span><br><span class="line">            | Intent.FLAG_ACTIVITY_CLEAR_TASK);</span><br><span class="line">    <span class="comment">// Creates the PendingIntent</span></span><br><span class="line">    PendingIntent notifyPendingIntent =</span><br><span class="line">            PendingIntent.getActivity(ct, <span class="number">0</span>, notifyIntent, PendingIntent.FLAG_UPDATE_CURRENT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Puts the PendingIntent into the notification builder</span></span><br><span class="line">    mBuilder.setContentIntent(notifyPendingIntent);</span><br><span class="line">    <span class="comment">// Notifications are issued by sending them to the</span></span><br><span class="line">    <span class="comment">// NotificationManager system service.</span></span><br><span class="line">    NotificationManager mNotificationManager =</span><br><span class="line">            (NotificationManager) ct.getSystemService(Context.NOTIFICATION_SERVICE);</span><br><span class="line">    <span class="comment">// Builds an anonymous Notification object from the builder, and</span></span><br><span class="line">    <span class="comment">// passes it to the NotificationManager</span></span><br><span class="line">    mNotificationManager.notify(UUID.randomUUID().hashCode(), mBuilder.build());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/assets/img/basic/notification/notification-pending-intent-special.gif" alt=""></p>
<h3 id="扩展通知"><a href="#扩展通知" class="headerlink" title="扩展通知"></a>扩展通知</h3><p>扩展通知在4.1之前不可用，扩展通知包括4种样式：</p>
<ul>
<li>BigTextStyle 大文本样式</li>
<li>InboxStyle 收件箱样式</li>
<li>BigPictureStyle 大图片样式</li>
<li>MediaStyle 媒体样式</li>
</ul>
<h4 id="大文本样式的通知"><a href="#大文本样式的通知" class="headerlink" title="大文本样式的通知"></a>大文本样式的通知</h4><p>我们需要使用NotificationCompat.BigTextStyle类设置大文本样式：</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="literal">void</span> bigTextStyleNotification(View view) &#123;</span><br><span class="line">    <span class="built_in">String</span> title = <span class="string">"Big Text Style Notification"</span>;</span><br><span class="line">    <span class="built_in">String</span> content = <span class="string">"Android 7.0 Nougat is here! Get your apps ready for the latest version of Android, with new system behaviors to save battery and memory."</span>;</span><br><span class="line">    NotificationCompat<span class="built_in">.</span>Builder mBuilder = generateBuilder(title, content);</span><br><span class="line"></span><br><span class="line">    NotificationCompat<span class="built_in">.</span>BigTextStyle bigTextStyle = <span class="literal">new</span> NotificationCompat<span class="built_in">.</span>BigTextStyle();</span><br><span class="line">    bigTextStyle<span class="built_in">.</span>setBigContentTitle(<span class="string">"Big Text Style Title"</span>);</span><br><span class="line">    bigTextStyle<span class="built_in">.</span>bigText(<span class="string">"Android 7.0 Nougat is here! Get your apps ready for the latest version of Android, with new system behaviors to save battery and memory."</span>);</span><br><span class="line">    <span class="comment">// Moves the expanded layout object into the notification object.</span></span><br><span class="line">    mBuilder<span class="built_in">.</span>setStyle(bigTextStyle);</span><br><span class="line">    <span class="comment">// Issue the notification here.</span></span><br><span class="line">    notify(UUID<span class="built_in">.</span>randomUUID()<span class="built_in">.</span>hashCode(), mBuilder);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/assets/img/basic/notification/notification-big-text.gif" alt=""><br>Android 5.1 &amp; Android 4.3</p>
<h4 id="收件箱样式的通知"><a href="#收件箱样式的通知" class="headerlink" title="收件箱样式的通知"></a>收件箱样式的通知</h4><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="literal">void</span> inboxStyleNotification(View view) &#123;</span><br><span class="line">    <span class="built_in">String</span> title = <span class="string">"Inbox Style Notification"</span>;</span><br><span class="line">    <span class="built_in">String</span> content = <span class="string">"Android 7.0 Nougat is here! Get your apps ready for the latest version of Android, with new system behaviors to save battery and memory."</span>;</span><br><span class="line">    NotificationCompat<span class="built_in">.</span>Builder mBuilder = generateBuilder(title, content);</span><br><span class="line"></span><br><span class="line">    NotificationCompat<span class="built_in">.</span>InboxStyle inboxStyle = <span class="literal">new</span> NotificationCompat<span class="built_in">.</span>InboxStyle();</span><br><span class="line">    <span class="comment">// Sets a title for the Inbox in expanded layout</span></span><br><span class="line">    inboxStyle<span class="built_in">.</span>setBigContentTitle(<span class="string">"Inbox Style Title"</span>);</span><br><span class="line">    <span class="comment">// Moves events into the expanded layout</span></span><br><span class="line">    inboxStyle<span class="built_in">.</span>setSummaryText(<span class="string">"Inbox Style Summary Text"</span>);</span><br><span class="line">    inboxStyle<span class="built_in">.</span>addLine(<span class="string">"Inbox Style Line 1"</span>);</span><br><span class="line">    inboxStyle<span class="built_in">.</span>addLine(<span class="string">"Inbox Style Line 2"</span>);</span><br><span class="line">    inboxStyle<span class="built_in">.</span>addLine(<span class="string">"Inbox Style Line 3"</span>);</span><br><span class="line">    <span class="comment">// Moves the expanded layout object into the notification object.</span></span><br><span class="line">    mBuilder<span class="built_in">.</span>setStyle(inboxStyle);</span><br><span class="line">    <span class="comment">// Issue the notification here.</span></span><br><span class="line">    notify(UUID<span class="built_in">.</span>randomUUID()<span class="built_in">.</span>hashCode(), mBuilder);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/assets/img/basic/notification/notification-inbox.png" alt=""><br>Android 5.1 &amp; Android 4.3</p>
<h4 id="大图片样式的通知"><a href="#大图片样式的通知" class="headerlink" title="大图片样式的通知"></a>大图片样式的通知</h4><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="literal">void</span> bigPictureStyleNotification(View view) &#123;</span><br><span class="line">    <span class="built_in">String</span> title = <span class="string">"Big Picture Style Notification"</span>;</span><br><span class="line">    <span class="built_in">String</span> content = <span class="string">"Android 7.0 Nougat is here! Get your apps ready for the latest version of Android, with new system behaviors to save battery and memory."</span>;</span><br><span class="line">    NotificationCompat<span class="built_in">.</span>Builder mBuilder = generateBuilder(title, content);</span><br><span class="line"></span><br><span class="line">    NotificationCompat<span class="built_in">.</span>BigPictureStyle bigPictureStyle = <span class="literal">new</span> NotificationCompat<span class="built_in">.</span>BigPictureStyle();</span><br><span class="line">    bigPictureStyle<span class="built_in">.</span>setBigContentTitle(<span class="string">"Big Picture"</span>);</span><br><span class="line">    bigPictureStyle<span class="built_in">.</span>setSummaryText(<span class="string">"Big Picture Summary Text"</span>);</span><br><span class="line">    bigPictureStyle<span class="built_in">.</span>bigPicture(BitmapFactory<span class="built_in">.</span>decodeResource(ct<span class="built_in">.</span>getResources(), R<span class="built_in">.</span>drawable<span class="built_in">.</span>big_image_android));</span><br><span class="line">    bigPictureStyle<span class="built_in">.</span>bigLargeIcon(BitmapFactory<span class="built_in">.</span>decodeResource(ct<span class="built_in">.</span>getResources(), R<span class="built_in">.</span>mipmap<span class="built_in">.</span>ic_launcher));</span><br><span class="line">    <span class="comment">// Moves the expanded layout object into the notification object.</span></span><br><span class="line">    mBuilder<span class="built_in">.</span>setStyle(bigPictureStyle);</span><br><span class="line">    <span class="comment">// Issue the notification here.</span></span><br><span class="line">    notify(UUID<span class="built_in">.</span>randomUUID()<span class="built_in">.</span>hashCode(), mBuilder);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/assets/img/basic/notification/notification-big-picture.png" alt=""><br>Android 5.1 &amp; Android 4.3</p>
<h4 id="媒体样式通知"><a href="#媒体样式通知" class="headerlink" title="媒体样式通知"></a>媒体样式通知</h4><p>从Android 5.0之后，可以在锁定屏幕上控制媒体播放：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mediaStyleNotification</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Creates an explicit intent for an Activity in your app</span></span><br><span class="line">    Intent resultIntent = <span class="keyword">new</span> Intent(ct, AboutActivity.<span class="keyword">class</span>);</span><br><span class="line">    <span class="comment">// The stack builder object will contain an artificial back stack for the</span></span><br><span class="line">    <span class="comment">// started Activity.</span></span><br><span class="line">    <span class="comment">// This ensures that navigating backward from the Activity leads out of</span></span><br><span class="line">    <span class="comment">// your application to the Home screen.</span></span><br><span class="line">    TaskStackBuilder stackBuilder = TaskStackBuilder.create(ct);</span><br><span class="line">    <span class="comment">// Adds the back stack for the Intent (but not the Intent itself)</span></span><br><span class="line">    stackBuilder.addParentStack(AboutActivity.<span class="keyword">class</span>);</span><br><span class="line">    <span class="comment">// Adds the Intent that starts the Activity to the top of the stack</span></span><br><span class="line">    stackBuilder.addNextIntent(resultIntent);</span><br><span class="line">    PendingIntent intent =</span><br><span class="line">            stackBuilder.getPendingIntent(<span class="number">0</span>, PendingIntent.FLAG_UPDATE_CURRENT);</span><br><span class="line"></span><br><span class="line">    String title = <span class="string">"Wonderful music"</span>;</span><br><span class="line">    String content = <span class="string">"My Awesome Band"</span>;</span><br><span class="line"></span><br><span class="line">    NotificationCompat.Builder mBuilder = generateBuilder(title, content);</span><br><span class="line">    mBuilder.setSmallIcon(R.drawable.music);</span><br><span class="line">    mBuilder.addAction(R.drawable.pre, <span class="string">"Previous"</span>, intent); <span class="comment">// #0</span></span><br><span class="line">    mBuilder.addAction(R.drawable.pause, <span class="string">"Pause"</span>, intent);  <span class="comment">// #1</span></span><br><span class="line">    mBuilder.addAction(R.drawable.next, <span class="string">"Next"</span>, intent);     <span class="comment">// #2</span></span><br><span class="line">    mBuilder.setStyle(<span class="keyword">new</span> android.support.v7.app.NotificationCompat.MediaStyle().setShowActionsInCompactView(<span class="number">1</span>));</span><br><span class="line">    mBuilder.setLargeIcon(BitmapFactory.decodeResource(ct.getResources(), R.drawable.record));</span><br><span class="line">    mBuilder.setAutoCancel(<span class="literal">false</span>);</span><br><span class="line">    mBuilder.build();</span><br><span class="line"></span><br><span class="line">    notify(<span class="number">9</span>, mBuilder);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/assets/img/basic/notification/notification-media-style.png" alt=""><br>Android 5.1 &amp; Android 4.3</p>
<h3 id="更新通知"><a href="#更新通知" class="headerlink" title="更新通知"></a>更新通知</h3><p>只要我们使用相同notifyID就可以实现通知的更新：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">updateNotification</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Start of a loop that processes data and then notifies the user</span></span><br><span class="line">    ++numMessages;</span><br><span class="line">    mBuilder.setContentText(<span class="string">"You've received "</span>+numMessages+<span class="string">" messages."</span>)</span><br><span class="line">            .setNumber(numMessages);</span><br><span class="line">    <span class="comment">// Because the ID remains unchanged, the existing notification is</span></span><br><span class="line">    <span class="comment">// updated.</span></span><br><span class="line">    <span class="comment">// mId allows you to update the notification later on.</span></span><br><span class="line">    notify(notifyID, mBuilder);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/assets/img/basic/notification/notification-update.png" alt=""><br>Android 5.1 &amp; Android 4.3</p>
<h3 id="删除通知"><a href="#删除通知" class="headerlink" title="删除通知"></a>删除通知</h3><ul>
<li>通过setAutoCancel()方法设置通知自动取消</li>
<li>通过cancel()删除指定ID的通知</li>
<li>通过cancelAll()删除所有发出的通知</li>
</ul>
<h3 id="进度条通知"><a href="#进度条通知" class="headerlink" title="进度条通知"></a>进度条通知</h3><p>对于Android 4.0之前，要在通知是显示进度指示器，必须创建包含ProgressBar的自定义通知布局。从Android 4.0之后，调用 setProgress()方法通知就可以显示进度指示器。</p>
<p>显示进度指示器的通知有两种样式：一是知道明确的进度值，二是不知道明确的进度值。</p>
<p>为了模拟进度指示器的通知，我们开启一个后台线程，在for循环中更新进度值：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">progressNotification</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    final NotificationManager mNotifyManager =</span><br><span class="line">            (NotificationManager) ct.getSystemService(Context.NOTIFICATION_SERVICE);</span><br><span class="line"></span><br><span class="line">    final String title = <span class="string">"Picture Download"</span>;</span><br><span class="line">    String content = <span class="string">"Download in progress"</span>;</span><br><span class="line">    final NotificationCompat.Builder mBuilder = generateBuilder(title, content);</span><br><span class="line">    mBuilder.setDefaults(NotificationCompat.DEFAULT_LIGHTS);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start a lengthy operation in a background thread</span></span><br><span class="line">    <span class="keyword">new</span> Thread(</span><br><span class="line">            <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                @<span class="function">Override</span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">int</span> incr;</span><br><span class="line">                    <span class="comment">// Do the "lengthy" operation 20 times</span></span><br><span class="line">                    <span class="keyword">for</span> (incr = <span class="number">0</span>; incr &lt;= <span class="number">100</span>; incr += <span class="number">5</span>) &#123;</span><br><span class="line">                        <span class="comment">// Sets the progress indicator to a max value, the</span></span><br><span class="line">                        <span class="comment">// current completion percentage, and "determinate"</span></span><br><span class="line">                        <span class="comment">// state</span></span><br><span class="line">                        mBuilder.setProgress(<span class="number">100</span>, incr, <span class="literal">false</span>);</span><br><span class="line">                        <span class="comment">// Displays the progress bar for the first time.</span></span><br><span class="line">                        mNotifyManager.notify(<span class="number">0</span>, mBuilder.build());</span><br><span class="line">                        <span class="comment">// Sleeps the thread, simulating an operation</span></span><br><span class="line">                        <span class="comment">// that takes time</span></span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="comment">// Sleep for 1 seconds</span></span><br><span class="line">                            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// When the loop is finished, updates the notification</span></span><br><span class="line">                    mBuilder.setContentText(<span class="string">"Download complete"</span>)</span><br><span class="line">                            <span class="comment">// Removes the progress bar</span></span><br><span class="line">                            .setProgress(<span class="number">0</span>, <span class="number">0</span>, <span class="literal">false</span>);</span><br><span class="line">                    mBuilder.setDefaults(NotificationCompat.DEFAULT_ALL);</span><br><span class="line">                    mNotifyManager.notify(<span class="number">0</span>, mBuilder.build());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Starts the thread by calling the run() method in its Runnable</span></span><br><span class="line">    ).start();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/assets/img/basic/notification/notification-progress.png" alt=""><br>Android 5.1 &amp; Android 4.3</p>
<p>当我们不知道明确的进度值时，我们只需修改上述代码中的这一行<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mBuilder.setProgress(<span class="number">100</span>, incr, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure></p>
<p>为下面的代码即可：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mBuilder.setProgress(<span class="number">0</span>, <span class="number">0</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure></p>
<p><img src="/assets/img/basic/notification/notification-progress-indederminate.png" alt=""><br>Android 5.1 &amp; Android 4.3</p>
<h3 id="浮动通知"><a href="#浮动通知" class="headerlink" title="浮动通知"></a>浮动通知</h3><p>从Android 5.0开始支持浮动通知，下列条件可以触发浮动通知：</p>
<ul>
<li>用户的 Activity 处于全屏模式中</li>
<li>通知具有较高的优先级并使用铃声或振动</li>
</ul>
<p>设置Intent时应该调用setFullScreenIntent方法，当设置了FullScreenIntent在Android 5.0以下版本运行时，发出通知会直接打开相应Activity。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fullScreenNotification</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">    String title = <span class="string">"Floating Notification by Full Screen Intent"</span>;</span><br><span class="line">    String content = <span class="string">"Android 7.0 Nougat is here! Get your apps ready for the latest version of Android, with new system behaviors to save battery and memory."</span>;</span><br><span class="line">    NotificationCompat.Builder mBuilder = generateBuilder(title, content);</span><br><span class="line">    <span class="comment">// Creates an explicit intent for an Activity in your app</span></span><br><span class="line">    Intent resultIntent = <span class="keyword">new</span> Intent(ct, AboutActivity.<span class="keyword">class</span>);</span><br><span class="line">    <span class="comment">// The stack builder object will contain an artificial back stack for the</span></span><br><span class="line">    <span class="comment">// started Activity.</span></span><br><span class="line">    <span class="comment">// This ensures that navigating backward from the Activity leads out of</span></span><br><span class="line">    <span class="comment">// your application to the Home screen.</span></span><br><span class="line">    TaskStackBuilder stackBuilder = TaskStackBuilder.create(ct);</span><br><span class="line">    <span class="comment">// Adds the back stack for the Intent (but not the Intent itself)</span></span><br><span class="line">    stackBuilder.addParentStack(AboutActivity.<span class="keyword">class</span>);</span><br><span class="line">    <span class="comment">// Adds the Intent that starts the Activity to the top of the stack</span></span><br><span class="line">    stackBuilder.addNextIntent(resultIntent);</span><br><span class="line">    PendingIntent fullScreenIntent =</span><br><span class="line">            stackBuilder.getPendingIntent(<span class="number">0</span>, PendingIntent.FLAG_UPDATE_CURRENT);</span><br><span class="line">    mBuilder.setFullScreenIntent(fullScreenIntent, <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// Issue the notification here.</span></span><br><span class="line">    notify(UUID.randomUUID().hashCode(), mBuilder);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/assets/img/basic/notification/notification-floating-full-screen.gif" alt=""><br>Android 5.1 &amp; Android 4.3</p>
<p>当设处于优先模式时，通过设置setCategory告诉系统如何处理应用的通知；通知默认优先级为0（PRIORITY_DEFAULT），当优先级设置为PRIORITY_MAX 或 PRIORITY_HIGH并使用铃声或振动时会触发浮动通知：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">priorityNotification</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Creates an explicit intent for an Activity in your app</span></span><br><span class="line">    Intent resultIntent = <span class="keyword">new</span> Intent(ct, AboutActivity.<span class="keyword">class</span>);</span><br><span class="line">    <span class="comment">// The stack builder object will contain an artificial back stack for the</span></span><br><span class="line">    <span class="comment">// started Activity.</span></span><br><span class="line">    <span class="comment">// This ensures that navigating backward from the Activity leads out of</span></span><br><span class="line">    <span class="comment">// your application to the Home screen.</span></span><br><span class="line">    TaskStackBuilder stackBuilder = TaskStackBuilder.create(ct);</span><br><span class="line">    <span class="comment">// Adds the back stack for the Intent (but not the Intent itself)</span></span><br><span class="line">    stackBuilder.addParentStack(AboutActivity.<span class="keyword">class</span>);</span><br><span class="line">    <span class="comment">// Adds the Intent that starts the Activity to the top of the stack</span></span><br><span class="line">    stackBuilder.addNextIntent(resultIntent);</span><br><span class="line">    PendingIntent intent =</span><br><span class="line">            stackBuilder.getPendingIntent(<span class="number">0</span>, PendingIntent.FLAG_UPDATE_CURRENT);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    String title = <span class="string">"Floating Notification by priority"</span>;</span><br><span class="line">    String content = <span class="string">"Android 7.0 Nougat is here! Get your apps ready for the latest version of Android, with new system behaviors to save battery and memory."</span>;</span><br><span class="line">    NotificationCompat.Builder mBuilder = generateBuilder(title, content);</span><br><span class="line">    mBuilder.setPriority(NotificationCompat.PRIORITY_MAX)</span><br><span class="line">            .setCategory(NotificationCompat.CATEGORY_ALARM)</span><br><span class="line">            .setStyle(<span class="keyword">new</span> NotificationCompat.BigTextStyle()</span><br><span class="line">                    .bigText(content))</span><br><span class="line">            .addAction (R.drawable.dismiss,</span><br><span class="line">                    <span class="string">"Dismiss"</span>, intent)</span><br><span class="line">            .addAction (R.drawable.snooze,</span><br><span class="line">                    <span class="string">"Snooze"</span>, intent);</span><br><span class="line">    notify(UUID.randomUUID().hashCode(), mBuilder);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/assets/img/basic/notification/notification-floating-priority.png" alt=""><br>Android 5.1 &amp; Android 4.3</p>
<h3 id="自定义通知"><a href="#自定义通知" class="headerlink" title="自定义通知"></a>自定义通知</h3><p>我们可以使用RemoteViews创建自定义通知，有兴趣的童鞋可以自行了解下。</p>
<h3 id="Android-7-0新特性"><a href="#Android-7-0新特性" class="headerlink" title="Android 7.0新特性"></a>Android 7.0新特性</h3><p>可以在通知上进行消息的快速回复（Replying to notifications）</p>
<p><img src="/assets/img/basic/notification/notification-inline-reply.png" alt=""><br>图片来自Android官方文档</p>
<p><img src="/assets/img/basic/notification/notification-inline-type-reply.png" alt=""><br>图片来自Android官方文档</p>
<p>折叠通知（Bundling notifications），如果有超过三条来自同一应用的通知，系统会强制进行折叠<br><img src="/assets/img/basic/notification/notification-bundles.png" alt=""><br>图片来自Android官方文档</p>
<p>更强大的自定义View（Custom Views）</p>
<p>MessagingStyle的支持<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Notification notification = <span class="keyword">new</span> Notification.Builder()</span><br><span class="line">             .setStyle(<span class="keyword">new</span> Notification.MessagingStyle(<span class="string">"Me"</span>)</span><br><span class="line">             .setConversationTitle(<span class="string">"Team lunch"</span>)</span><br><span class="line">             .addMessage(<span class="string">"Hi"</span>, timestamp1, <span class="literal">null</span>) <span class="regexp">//</span> Pass <span class="keyword">in</span> <span class="literal">null</span> <span class="keyword">for</span> user.</span><br><span class="line">             .addMessage(<span class="string">"What's up?"</span>, timestamp2, <span class="string">"Coworker"</span>)</span><br><span class="line">             .addMessage(<span class="string">"Not much"</span>, timestamp3, <span class="literal">null</span>)</span><br><span class="line">             .addMessage(<span class="string">"How about lunch?"</span>, timestamp4, <span class="string">"Coworker"</span>))</span><br><span class="line">             .build();</span><br></pre></td></tr></table></figure></p>
<p>完整源码：<a href="https://github.com/yuweiguocn/NotificationDemo" target="_blank" rel="external">https://github.com/yuweiguocn/NotificationDemo</a></p>
<blockquote>
<p>关于新特性的功能，且听下回分解。</p>
</blockquote>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/09/23/android-basic-animation-1/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          android-basic-animation-1
        
      </div>
    </a>
  
  
    <a href="/2016/09/13/android-summary-event-dispath/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Android事件分发机制源码分析及总结</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>






<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="android-basic-notification" data-title="Android基础——Notification" data-url="http://yoursite.com/2016/09/16/android-basic-notification/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"yuweiguo"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 于卫国
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: falsee,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>